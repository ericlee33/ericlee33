---
title: 与后端对接口SOP
date: 2020-9-20 16:20:57
tags: 前端
categories:
- 前端
---
<a name="DZpda"></a>
### 背景
如何与后端对好接口？这在大型需求中尤为重要。<br />首先，如果你嫌对接口比较麻烦，选择不对接口，让后端先行，从表面上看，这是可行的，但是！这需要后端写好注释。<br />鉴于目前yapi文档是根据后端提供的swagger.json，每10分钟进行全部覆盖，所以后端同学在yapi上手动添加字段注释是不可行的。<br />这也就说明，即便后端先行，前端也需要与后端同学对清楚每个字段的含义，不能够跳过对接口的环节。
<a name="FBC9O"></a>
### 目的
目前，大部分大型需求的优先级是high，需要前后端同时推进需求，保证前后端对好接口，这样倘若前端写页面比较快的话，就可以先假定字段名为后端规定字段，在接口出来之前，在代码中去使用所用字段。<br />

<a name="wr3WI"></a>
### **Hack Methods:**
如果你愿意节约后端时间成本的，认为后端的命名不给力，可以不用把接口对的很详细，前端去定义变量名，等后端接口到位之后，用map方法进行一层映射。<br />
<!-- more -->
<a name="PlM9D"></a>
### Badcase
1.后端同学扔过来一个yapi文档，里面有几张数据库表，告诉你看这个就好了 -> 这样是不可以的，因为接口中的字段肯定是与表中字段名称不一致的，你仍旧没法确定每个字段的名称。<br />2.如果字段不存在值，后端可能字段会返回null -> 为了减少前端判空的工作量，一定要提前跟后端同学打好招呼，避免这种情况发生，不然你的代码中可能就会出现很多??运算符。<br />3.提前和后端打好招呼了，但后端同学并没有找你对接口，并告诉你说晚点对 -> 提前和后端同学确定对**接口的具体时间**，超过时间点后，可以主动提醒后端同学。
<a name="ofUiI"></a>
### 那么如何才能对好接口？
首先在和产品评审需求之前，如果产品同学没有拉后端，前端可以先看一下现有相关代码，确定需不需要后端？如果需要后端，评审时要让产品一并拉一个后端。<br />准备开始做需求之前，如果后端同学不主动拉你对字段的话，那就要向后端同学询问，后端什么时候开始，并打好招呼，要求在开始做之前，对一下接口中所用到的字段名称。

- **使用原接口，在该接口增量字段**

**新接口，字段比较少**<br />这两种情况，如果字段比较少，可以与后端同学在企业微信上沟通一下，双方约定好这些字段的名称即可。

- **新接口，且字段较多**

这种情况，理想情况是让后端同学提供一份wiki文档，标明所有字段。<br />**但是，如果推不动后端作wiki文档的话⬇️**<br />让后端同学尽快提供一个测试接口，包含所有字段，接口数据为mock形式。<br />**如果以上方式也不行的话**<br />⚠️先去做别的需求吧，让后端先行<br />

<a name="AOUbM"></a>
### 如何调试
后端同学在接口做出来后，会先进行自测，但是在前端调用时，受到多重原因，不一定能成功调用接口，一般来说有几种可能，下面进行列举：<br />

1. 接口调用失败，前端console的报错内容包括CORS，这种情况，需要让后端同学打开跨域，这种接口一般是文件/图片/视频/音频上传接口。
1. 例如cat中上传接口，需要鉴权，这种需要调用类似于/api/v2/oss/policy这种接口，获得所需要的OSSAccessKeyId，policy，Signature，host字段，上传时一并带上。
1. 接口调用返回1000状态码，首先，1000代表报错 => 有些项目1000是前端进行收敛的，发生这种情况要确认以下几点：
- 前端调用接口时传入的参数是否正确？
- 前端调用接口的content-type是否正确？
- 后端要求传入数字，前端是否传成了字符串？

如果以上几点都排查过没有问题，找后端同学，90%是后端问题。

4. 接口一直pending，确定自己没有开梯子且网络没有问题的话，找后端。可能是后端正在debug
4. 在stage环境下，接口返回404，not found，这种情况80%是后端发版时，有一台机器没有发上去，如果后端确认确实发上去了，排查一下是不是前端node接口转发出现问题。
4. Others....
<a name="3RjsW"></a>
### 预期之外？
需求开始前期，已经和后端同学定好了接口的字段名称，但是实际拿到接口后，字段出现不一致情况。<br /><br />**前端不能妥协，问清楚原因，让后端改！！**
